<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="data/style.css">
    <title>COLLECTIONS</title>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-1 avg left"><a id="returnbtn" href="index.html"><</a></div>
            <div class="col-10 big center">COLLECTIONS</div>
        </div>

        <div class="row">
            <div class="col-md-6 col-sm-12">


                <div class="form-group col-md-4 mb-0 first-col white">
                    <input type="text" class="form-control customborder white" id="addInp" placeholder="New collection name">
                    <button id="addBtn" class="btn btn-primary customborder mt-1">ADD COLLECTION</button>
                </div>

                <br />
                <label for="collection">Collections↓</label>

                <select class="form-control customborder tall" id="collection" size="10"></select>

                <div class="form-group col-md-4 mb-0 first-col mt-2">
                    <input type="text" class="form-control customborder white" id="editInp" placeholder="Edit selected collection">
                    <button id="editBtn" class="btn btn-warning customborder mt-1">EDIT</button>
                    <button id="deleteBtn" class="btn btn-danger customborder mt-1">DELETE</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const collectionSelect = document.getElementById('collection');
            const addInp = document.getElementById('addInp');
            const addBtn = document.getElementById('addBtn');
            const editInp = document.getElementById('editInp');
            const editBtn = document.getElementById('editBtn');
            const deleteBtn = document.getElementById('deleteBtn');


            loadCollections();

            addBtn.addEventListener('click', function () {
                const name = addInp.value.trim();
                if (!name) return alert("Enter collection name");

                fetch('/api/collections', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name })
                })
                    .then(res => res.json())
                    .then(() => {
                        addInp.value = "";
                        loadCollections();
                    })
                    .catch(err => alert(err));
            });


            editBtn.addEventListener('click', function () {
                const selectedId = collectionSelect.value;
                const name = editInp.value.trim();

                if (!selectedId) return alert("Select a collection to edit");
                if (!name) return alert("Enter a new name");

                fetch(`/api/collections/${selectedId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name })
                })
                    .then(res => {
                        if (!res.ok) throw new Error("Failed to edit");
                        editInp.value = "";
                        loadCollections();
                    })
                    .catch(err => alert(err.message));
            });


            deleteBtn.addEventListener('click', function () {
                const selectedId = collectionSelect.value;
                if (!selectedId) return alert("Select a collection to delete");

                if (!confirm("Are you sure you want to delete this collection?")) return;

                fetch(`/api/collections/${selectedId}`, {
                    method: 'DELETE'
                })
                    .then(res => {
                        if (!res.ok) throw new Error("Failed to delete");
                        loadCollections();
                    })
                    .catch(err => alert(err.message));
            });

            function loadCollections() {
                fetch('/api/collections')
                    .then(res => res.json())
                    .then(collections => {
                        collectionSelect.innerHTML = "";
                        collections.forEach(col => {
                            const option = document.createElement('option');
                            option.textContent = col.name;
                            option.value = col.id;
                            collectionSelect.appendChild(option);
                        });
                    })
                    .catch(err => console.error(err));
            }

            collectionSelect.addEventListener('change', function () {
                const selectedOption = collectionSelect.selectedOptions[0];
                editInp.value = selectedOption ? selectedOption.textContent : "";
            });
        });
    </script>
</body>
</html>
